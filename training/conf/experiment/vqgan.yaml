# @package _global_

defaults:
  - override /network: vqvae
  - override /criterion: vqgan_loss
  - override /model: lit_vqgan
  - override /callbacks: wandb_vae
  - override /optimizers: null
  - override /lr_schedulers: null

criterion:
  _target_: text_recognizer.criterions.vqgan_loss.VQGANLoss
  reconstruction_loss:
    _target_: torch.nn.L1Loss
    reduction: mean
  discriminator:
    _target_: text_recognizer.criterions.n_layer_discriminator.NLayerDiscriminator
    in_channels: 1
    num_channels: 32
    num_layers: 3
  vq_loss_weight: 0.8
  discriminator_weight: 0.8
  discriminator_factor: 1.0
  discriminator_iter_start: 2e4

datamodule:
  batch_size: 8

lr_schedulers:
  generator:
    _target_: torch.optim.lr_scheduler.CosineAnnealingLR
    T_max: 256
    eta_min: 0.0
    last_epoch: -1

    interval: epoch
    monitor: val/loss

  discriminator:
    _target_: torch.optim.lr_scheduler.CosineAnnealingLR
    T_max: 256
    eta_min: 0.0
    last_epoch: -1

    interval: epoch
    monitor: val/loss

optimizers:
  generator:
    _target_: madgrad.MADGRAD
    lr: 4.5e-6
    momentum: 0.5
    weight_decay: 0
    eps: 1.0e-6

    parameters: network

  discriminator:
    _target_: madgrad.MADGRAD
    lr: 4.5e-6
    momentum: 0.5
    weight_decay: 0
    eps: 1.0e-6

    parameters: loss_fn.discriminator

trainer:
  max_epochs: 256
  # gradient_clip_val: 0.25

summary: null
