experiment_group: Lines Experiments
experiments:
    - train_args:
        batch_size: 64
        max_epochs: &max_epochs 32
      dataset:
        type: IamLinesDataset
        args:
          subsample_fraction: null
          transform: null
          target_transform: null
        train_args:
          num_workers: 8
          train_fraction: 0.85
      model: LineCTCModel
      metrics: [cer, wer]
      network:
        type: LineRecurrentNetwork
        args:
          # backbone: ResidualNetwork
          # backbone_args:
          #   in_channels: 1
          #   num_classes: 64 # Embedding
          #   depths: [2,2]
          #   block_sizes: [32, 64]
          #   activation: selu
          #   stn: false
          backbone: ResidualNetwork
          backbone_args:
            pretrained: training/experiments/CharacterModel_EmnistDataset_ResidualNetwork/0920_010806/model/best.pt
            freeze: false
          flatten: false
          input_size: 64
          hidden_size: 64
          bidirectional: true
          num_layers: 2
          num_classes: 80
          patch_size: [28, 18]
          stride: [1, 4]
      criterion:
        type: CTCLoss
        args:
          blank: 79
      optimizer:
        type: AdamW
        args:
          lr: 1.e-02
          betas: [0.9, 0.999]
          eps: 1.e-08
          weight_decay: 5.e-4
          amsgrad: false
      lr_scheduler:
        type: OneCycleLR
        args:
          max_lr: 1.e-02
          epochs: *max_epochs
          anneal_strategy: cos
          pct_start: 0.475
          cycle_momentum: true
          base_momentum: 0.85
          max_momentum: 0.9
          div_factor: 10
          final_div_factor: 10000
          interval: step
      # lr_scheduler:
      #   type: CosineAnnealingLR
      #   args:
      #     T_max: *max_epochs
      swa_args:
        start: 48
        lr: 5.e-2
      callbacks: [Checkpoint, ProgressBar, WandbCallback, WandbImageLogger, EarlyStopping]
      callback_args:
        Checkpoint:
          monitor: val_loss
          mode: min
        ProgressBar:
          epochs: *max_epochs
        EarlyStopping:
          monitor: val_loss
          min_delta: 0.0
          patience: 10
          mode: min
        WandbCallback:
          log_batch_frequency: 10
        WandbImageLogger:
          num_examples: 6
      verbosity: 1 # 0, 1, 2
      resume_experiment: null
      test: true
      test_metric: test_cer
